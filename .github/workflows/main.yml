name: Android CI  
  
on:  
  push:  
    branches: [ main, master, develop ]  
  pull_request:  
    branches: [ main, master, develop ]  
  workflow_dispatch:  
  
jobs:  
  build:  
    runs-on: ubuntu-latest  
      
    steps:  
    - uses: actions/checkout@v4  
      
    - name: Set up JDK 18  
      uses: actions/setup-java@v4  
      with:  
        java-version: '18'  
        distribution: 'temurin'  
          
    - name: Cache Gradle packages  
      uses: actions/cache@v3  
      with:  
        path: |  
          ~/.gradle/caches  
          ~/.gradle/wrapper  
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}  
        restore-keys: |  
          ${{ runner.os }}-gradle-  
            
    - name: Cache NDK  
      uses: actions/cache@v3  
      with:  
        path: |  
          ~/.android/ndk  
        key: ${{ runner.os }}-ndk-${{ hashFiles('**/build.gradle*') }}  
          
    - name: Grant execute permission for gradlew  
      run: chmod +x gradlew  
    - name: Create local.properties  
      run: |  
        echo "sdk.dir=$ANDROID_HOME" > local.properties  
        echo "storeFile=$HOME/.android/debug.keystore" >> local.properties  
        echo "storePassword=android" >> local.properties  
        echo "keyAlias=androiddebugkey" >> local.properties  
        echo "keyPassword=android" >> local.properties
    
    - name: Build debug APK (without signing)  
      run: ./gradlew assembleDebug -Pandroid.injected.signing.store.file=$HOME/.android/debug.keystore -Pandroid.injected.signing.store.password=android -Pandroid.injected.signing.key.alias=androiddebugkey -Pandroid.injected.signing.key.password=android  
        
    - name: Upload debug APK  
      uses: actions/upload-artifact@v4  
      with:  
        name: debug-apk  
        path: app/build/outputs/apk/debug/*.apk  
